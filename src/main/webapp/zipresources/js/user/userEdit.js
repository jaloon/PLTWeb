$(function(){var h=parent.layer.getFrameIndex(window.name);var g="修改成功！";var f="修改失败！";var e=$("#mode").val();$("#confirm").click(function(){if("pwd"==e){var a=$("#id").val();var z=$.trim($("#oldPwd").val());var w=$.trim($("#pwd").val());var u=$.trim($("#repwd").val());var b="../../manage/user/updatePwd.do";var x="id="+a+"&password="+w+"&oldPwd="+z;if(isNull(z)||isNull(w)||isNull(u)){layer.alert("密码不能为空！",{icon:5});return}if(w!=u){layer.alert("两次输入新密码不一致！",{icon:5});return}$.post(b,x,function(i){if("error"==i.msg){if("oldPwdError"==i.e){layer.alert("原密码不正确！",{icon:2},function(j){layer.close(j);$("#oldPwd").select()})}else{layer.msg(f,{icon:2,time:500})}}else{layer.msg(g,{icon:1,time:500},function(){parent.layer.close(h)})}},"json").fail(function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}})}else{var a=$("#id").html();var r=$.trim($("#account").html());var s=$("#roleId").val();var y=$.trim($("#name").val());var c=$.trim($("#phone").val());var d=$.trim($("#identityCard").val());var t=$.trim($("#remark").val());var b="../../manage/user/update.do";var x="id="+a+"&account="+r+"&roleId="+s+"&name="+y+"&phone="+c+"&identityCard="+d+"&remark="+t;if("add"==e){r=$.trim($("#account").val());b="../../manage/user/add.do";x="account="+r+"&roleId="+s+"&name="+y+"&phone="+c+"&identityCard="+d+"&remark="+t;g="添加成功！";f="添加失败！";if(!isAccount(r)){layer.alert("账号不符规则！",{icon:5},function(i){layer.close(i);$("#account").select()});return}else{var v=true;$.ajax({type:"post",async:false,url:"../../manage/user/isExist.do",data:"account="+r,dataType:"json",success:function(i){if(i==true||i=="true"){v=false;layer.alert("账号已存在！",{icon:5},function(j){layer.close(j);$("#account").select()})}},error:function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}}});if(!v){return}}}if(isNull(y)){layer.alert("姓名不能为空！",{icon:0},function(i){layer.close(i);$("#name").select()});return}if(!isPhone(c)){layer.alert("电话号码不正确！",{icon:5},function(i){layer.close(i);$("#phone").select()});return}if(!isIdCard(d)){layer.alert("身份证号不正确！",{icon:5},function(i){layer.close(i);$("#identityCard").select()});return}$.post(b,x,function(i){if("error"==i.msg){layer.msg(f,{icon:2,time:500})}else{layer.msg(g,{icon:1,time:500},function(){parent.layer.close(h)})}},"json").fail(function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}})}});$("#cancel").click(function(){parent.layer.close(h)})});