$(function(){var a=parent.layer.getFrameIndex(window.name);var b="修改成功！";var c="修改失败！";var d=$("#mode").val();$("#confirm").click(function(){if("pwd"==d){var g=$("#id").val();var h=$.trim($("#oldPwd").val());var q=$.trim($("#pwd").val());var k=$.trim($("#repwd").val());var f="../../manage/user/updatePwd.do";var i="id="+g+"&password="+q+"&oldPwd="+h;if(isNull(h)||isNull(q)||isNull(k)){layer.alert("密码不能为空！",{icon:5});return}if(q!=k){layer.alert("两次输入新密码不一致！",{icon:5});return}$.post(f,i,function(r){if("error"==r.msg){if("oldPwdError"==r.e){layer.alert("原密码不正确！",{icon:2},function(s){layer.close(s);$("#oldPwd").select()})}else{layer.msg(c,{icon:2,time:500})}}else{layer.msg(b,{icon:1,time:500},function(){parent.layer.close(a)})}},"json").fail(function(s,u,t){if(s.readyState==4){var r=s.status;if(r==0||r>600){location.reload(true)}else{if(r==200){if(u=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+u)}}else{layer.alert("http connection error: status["+r+"], "+s.statusText)}}}})}else{var g=$("#id").html();var o=$.trim($("#account").html());var l=$("#roleId").val();var e=$.trim($("#name").val());var p=$.trim($("#phone").val());var n=$.trim($("#identityCard").val());var m=$.trim($("#remark").val());var f="../../manage/user/update.do";var i="id="+g+"&account="+o+"&roleId="+l+"&name="+e+"&phone="+p+"&identityCard="+n+"&remark="+m;if("add"==d){o=$.trim($("#account").val());f="../../manage/user/add.do";i="account="+o+"&roleId="+l+"&name="+e+"&phone="+p+"&identityCard="+n+"&remark="+m;b="添加成功！";c="添加失败！";if(!isAccount(o)){layer.alert("账号不符规则！",{icon:5},function(r){layer.close(r);$("#account").select()});return}else{var j=true;$.ajax({type:"post",async:false,url:"../../manage/user/isExist.do",data:"account="+o,dataType:"json",success:function(r){if(r==true||r=="true"){j=false;layer.alert("账号已存在！",{icon:5},function(s){layer.close(s);$("#account").select()})}},error:function(s,u,t){j=false;if(s.readyState==4){var r=s.status;if(r==0||r>600){location.reload(true)}else{if(r==200){if(u=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+u)}}else{layer.alert("http connection error: status["+r+"], "+s.statusText)}}}}});if(!j){return}}}if(isNull(e)){layer.alert("姓名不能为空！",{icon:0},function(r){layer.close(r);$("#name").select()});return}$.post(f,i,function(r){if("error"==r.msg){layer.msg(c,{icon:2,time:500})}else{layer.msg(b,{icon:1,time:500},function(){parent.layer.close(a)})}},"json").fail(function(s,u,t){if(s.readyState==4){var r=s.status;if(r==0||r>600){location.reload(true)}else{if(r==200){if(u=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+u)}}else{layer.alert("http connection error: status["+r+"], "+s.statusText)}}}})}});$("#cancel").click(function(){parent.layer.close(a)})});