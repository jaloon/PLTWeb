$(function(){var f=parent.layer.getFrameIndex(window.name);var e="修改成功！";var h="修改失败！";var g=$("#mode").val();$("#confirm").click(function(){if("pwd"==g){var x=$("#id").val();var w=$.trim($("#oldPwd").val());var a=$.trim($("#pwd").val());var t=$.trim($("#repwd").val());var y="../../manage/user/updatePwd.do";var v="id="+x+"&password="+a+"&oldPwd="+w;if(isNull(w)||isNull(a)||isNull(t)){layer.alert("密码不能为空！",{icon:5});return}if(a!=t){layer.alert("两次输入新密码不一致！",{icon:5});return}$.post(y,v,function(i){if("error"==i.msg){if("oldPwdError"==i.e){layer.alert("原密码不正确！",{icon:2},function(j){layer.close(j);$("#oldPwd").select()})}else{layer.msg(h,{icon:2,time:500})}}else{layer.msg(e,{icon:1,time:500},function(){parent.layer.close(f)})}},"json").fail(function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}})}else{var x=$("#id").html();var c=$.trim($("#account").html());var s=$("#roleId").val();var z=$.trim($("#name").val());var b=$.trim($("#phone").val());var d=$.trim($("#identityCard").val());var r=$.trim($("#remark").val());var y="../../manage/user/update.do";var v="id="+x+"&account="+c+"&roleId="+s+"&name="+z+"&phone="+b+"&identityCard="+d+"&remark="+r;if("add"==g){c=$.trim($("#account").val());y="../../manage/user/add.do";v="account="+c+"&roleId="+s+"&name="+z+"&phone="+b+"&identityCard="+d+"&remark="+r;e="添加成功！";h="添加失败！";if(!isAccount(c)){layer.alert("账号不符规则！",{icon:5},function(i){layer.close(i);$("#account").select()});return}else{var u=true;$.ajax({type:"post",async:false,url:"../../manage/user/isExist.do",data:"account="+c,dataType:"json",success:function(i){if(i==true||i=="true"){u=false;layer.alert("账号已存在！",{icon:5},function(j){layer.close(j);$("#account").select()})}},error:function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}}});if(!u){return}}}if(isNull(z)){layer.alert("姓名不能为空！",{icon:0},function(i){layer.close(i);$("#name").select()});return}$.post(y,v,function(i){if("error"==i.msg){layer.msg(h,{icon:2,time:500})}else{layer.msg(e,{icon:1,time:500},function(){parent.layer.close(f)})}},"json").fail(function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}})}});$("#cancel").click(function(){parent.layer.close(f)})});