$(function(){var f=parent.layer.getFrameIndex(window.name);var e="修改成功！";var h="修改失败！";var g=$("#mode").val();$("#confirm").click(function(){if("pwd"==g){var a=$("#id").val();var z=$.trim($("#oldPwd").val());var b=$.trim($("#pwd").val());var u=$.trim($("#repwd").val());var c="../../manage/user/updatePwd.do";var y="id="+a+"&password="+b+"&oldPwd="+z;if(isNull(z)||isNull(b)||isNull(u)){layer.alert("密码不能为空！",{icon:5});return}if(b!=u){layer.alert("两次输入新密码不一致！",{icon:5});return}$.post(c,y,function(i){if("error"==i.msg){if("oldPwdError"==i.e){layer.alert("原密码不正确！",{icon:2},function(j){layer.close(j);$("#oldPwd").select()})}else{layer.msg(h,{icon:2,time:500})}}else{layer.msg(e,{icon:1,time:500},function(){parent.layer.close(f)})}},"json").fail(function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}})}else{var a=$("#id").html();var r=$.trim($("#account").html());var s=$("#roleId").val();var t=$.trim($("#name").val());var d=$.trim($("#phone").val());var v=$.trim($("#identityCard").val());var w=$.trim($("#remark").val());var c="../../manage/user/update.do";var y="id="+a+"&account="+r+"&roleId="+s+"&name="+t+"&phone="+d+"&identityCard="+v+"&remark="+w;if("add"==g){r=$.trim($("#account").val());c="../../manage/user/add.do";y="account="+r+"&roleId="+s+"&name="+t+"&phone="+d+"&identityCard="+v+"&remark="+w;e="添加成功！";h="添加失败！";if(!isAccount(r)){layer.alert("账号不符规则！",{icon:5},function(i){layer.close(i);$("#account").select()});return}else{var x=true;$.ajax({type:"post",async:false,url:"../../manage/user/isExist.do",data:"account="+r,dataType:"json",success:function(i){if(i==true||i=="true"){x=false;layer.alert("账号已存在！",{icon:5},function(j){layer.close(j);$("#account").select()})}},error:function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}}});if(!x){return}}}if(isNull(t)){layer.alert("姓名不能为空！",{icon:0},function(i){layer.close(i);$("#name").select()});return}$.post(c,y,function(i){if("error"==i.msg){layer.msg(h,{icon:2,time:500})}else{layer.msg(e,{icon:1,time:500},function(){parent.layer.close(f)})}},"json").fail(function(k,i,j){if(k.readyState==4){var l=k.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+l+"], "+k.statusText)}}}})}});$("#cancel").click(function(){parent.layer.close(f)})});