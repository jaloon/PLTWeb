var dispatch;var deleteUser;var resetPwd;$(function(){dispatch=function(b,a){var g="添加操作员";var h="343px";if("edit"==b){g="修改操作员信息";h="379px"}if("view"==b){g="查看操作员信息";h="321px"}layer.open({type:2,title:["操作员管理（"+g+"）","font-size:14px;color:#ffffff;background:#478de4;"],shade:0.8,area:["540px",h],content:"../../manage/user/dispatch.do?mode="+b+"&id="+a,end:function(){if(b!="view"){c()}}})};deleteUser=function(a){layer.confirm("删除后不可撤销，是否确认删除？",{icon:0,title:["删除","font-size:14px;color:#ffffff;background:#478de4;"]},function(){$.post("../../manage/user/delete.do","id="+a,function(b){if("success"==b.msg){layer.msg("删除成功！",{icon:1,time:500},function(){c()})}else{layer.msg("删除失败！",{icon:2,time:500})}},"json").fail(function(b,i,j){if(b.readyState==4){var h=b.status;if(h==0||h>600){location.reload(true)}else{if(h==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+h+"], "+b.statusText)}}}})})};resetPwd=function(a){layer.confirm("确认重置密码？",{icon:4,title:["密码重置","font-size:14px;color:#ffffff;background:#478de4;"]},function(){$.post("../../manage/user/reset.do","id="+a,function(b){if("success"==b.msg){layer.msg("重置成功！",{icon:1,time:500})}else{layer.msg("重置失败！",{icon:2,time:500})}},"json").fail(function(b,i,j){if(b.readyState==4){var h=b.status;if(h==0||h>600){location.reload(true)}else{if(h==200){if(i=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+i)}}else{layer.alert("http connection error: status["+h+"], "+b.statusText)}}}})})};function d(b,i,j){var h=$("#page_size").val();var a=(j-1)*h;$.post("../../manage/user/ajaxFindForPage.do","account="+b+"&name="+i+"&pageId="+j+"&startRow="+a+"&rows="+h,function(p){var g=$("#page_id option:last").index();var q=g+1-p.total;if(q>0){for(var r=p.total>0?p.total:1;r<g+1;r++){$("#page_id option:last").remove()}}else{if(q<0){for(var r=g+2;r<=p.total;r++){$("#page_id").append("<option value="+r+">"+r+"</option>")}}}$("#page_id").val(p.page);$("#page_info").html("页("+p.currentRows+"条数据)/共"+p.total+"页(共"+p.records+"条数据)");$("#uaccount").val(p.t.account);$("#uname").val(p.t.name);$(".table-body").html("");var e=p.dataList;var o="<table width='100%'>";for(var r=0;r<p.currentRows;r++){var f=e[r];o+='<tr><td class="user-id">'+f.id+'</td><td class="user-account">'+f.account+'</td><td class="user-role">'+f.role.name+'</td><td class="user-name">'+f.name+'</td><td class="user-phone">'+f.phone+'</td><td class="user-card">'+f.identityCard+'</td><td class="user-remark">'+f.remark+'</td><td class="user-action"><img src="../../resources/images/operate/view.png" alt="查看" title="查看" onclick="dispatch(\'view\','+f.id+')">&emsp;<img src="../../resources/images/operate/edit.png" alt="编辑" title="编辑" onclick="dispatch(\'edit\','+f.id+')">&emsp;<img src="../../resources/images/operate/delete.png" alt="删除" title="删除" onclick="deleteUser('+f.id+')">&emsp;<img src="../../resources/images/operate/repwd.png" alt="重置密码" title="重置密码" onclick="resetPwd('+f.id+')"></td></tr>'}o+="</table>";o=o.replace(/>null</g,"><");$(".table-body").html(o)},"json").fail(function(g,e,f){if(g.readyState==4){var l=g.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(e=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+e)}}else{layer.alert("http connection error: status["+l+"], "+g.statusText)}}}})}d("","",1);$("#search_btn").click(function(){var a=$("#search_type").val();if(a==0){layer.alert("请选择查询类型！",{icon:6})}else{var f="";var b="";if(a==1){f=$.trim($("#search_text").val());if(isNull(f)){layer.alert("请输入要查询的账号！",{icon:6},function(e){layer.close(e);$("#search_text").select()})}}else{b=$.trim($("#search_text").val());if(isNull(b)){layer.alert("请输入要查询的姓名！",{icon:6},function(e){layer.close(e);$("#search_text").select()})}}d(f,b,1)}});function c(){var b=$("#page_id").val();if(isNull(b)){b=1}var f=$("#uaccount").val();if(isNull(f)){f=""}var a=$("#uname").val();if(isNull(a)){a=""}d(f,a,b)}$("#page_id").change(function(){c()});$("#page_size").change(function(){var a=$("#uaccount").val();if(isNull(a)){a=""}var b=$("#uname").val();if(isNull(b)){b=""}d(a,b,1)})});