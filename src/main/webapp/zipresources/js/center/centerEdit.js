$(function(){var h=parent.layer.getFrameIndex(window.name);var c;var b="修改成功！";var e="修改失败！";var g=$("#mode").val();var d="";var p="ftp",j="",a="",o="",n="",l="",m="";if("edit"==g){k();i()}function k(){p=$.trim($("#ftp_protocol").val());j=$.trim($("#ftp_host").val());a=$.trim($("#ftp_port").val())==""?"":parseInt($.trim($("#ftp_port").val()),10);o=$.trim($("#ftp_directory").val());n=$.trim($("#ftp_account").val());l=$.trim($("#ftp_password").val());m=$.trim($("#ftp_remark").val())}function i(){var q={protocol:p,host:j,port:a,directory:o,account:n,password:l,remark:m};d=encodeURIComponent(JSON.stringify(q));return q}$("#ftp").click(function(){var r="添加ftp配置";var q="361px";if("edit"==g){r="修改ftp配置"}else{if("view"==g){k();r="查看ftp配置";q="322px"}}c=layer.open({type:1,title:["用户中心管理（"+r+"）","font-size:14px;color:#ffffff;background:#478de4;"],area:["500px",q],content:$(".ftp"),end:f()})});function f(){$("#ftp_protocol").val(p);$("#ftp_host").val(j);$("#ftp_port").val(a);$("#ftp_directory").val(o);$("#ftp_account").val(n);$("#ftp_password").val(l);$("#ftp_remark").val(m)}$("#ftp_cancel").click(function(){f();layer.close(c)});$("#ftp_confirm").click(function(){var r=$.trim($("#ftp_protocol").val());var t=$.trim($("#ftp_host").val());var v=$.trim($("#ftp_port").val())==""?"":parseInt($.trim($("#ftp_port").val()),10);var s=$.trim($("#ftp_directory").val());var q=$.trim($("#ftp_account").val());var u=$.trim($("#ftp_password").val());var x=$.trim($("#ftp_remark").val());if(!isIP(t)){layer.alert("主机IP地址不正确！",{icon:2},function(y){layer.close(y);$("#ftp_host").select()});return}if(!isPort(v)){layer.alert("端口号不正确！",{icon:2},function(y){layer.close(y);$("#ftp_port").select()});return}if(!isFtpDir(s)){layer.alert("文件目录格式不正确！",{icon:2},function(y){layer.close(y);$("#ftp_directory").select()});return}if(isNull(q)){layer.alert("ftp账号不能为空！",{icon:2},function(y){layer.close(y);$("#ftp_account").select()});return}if(isNull(u)){layer.alert("ftp密码不能为空！",{icon:2},function(y){layer.close(y);$("#ftp_password").select()});return}k();var w=i();$("#ftp").html(ftpConfigConverter(w));layer.close(c)});$("#cancel").click(function(){parent.layer.close(h)});$("#confirm").click(function(){var A=$("#id").val();var B=$.trim($("#name").val());var u=$.trim($("#ip").val());var s=$.trim($("#web").val());var x=$.trim($("#tcp").val());var y=$.trim($("#barrier").val());var C=$.trim($("#director").val());var v=$.trim($("#phone").val());var w=$.trim($("#address").val());var t=$.trim($("#remark").val());var z="../../manage/center/update.do";var q="id="+A+"&name="+B+"&ip="+u+"&webPort="+s+"&tcpPort="+x+"&barrierPort="+y+"&director="+C+"&phone="+v+"&address="+w+"&remark="+t+"&ftp="+d;if("add"==g){z="../../manage/center/add.do";q="name="+B+"&ip="+u+"&webPort="+s+"&tcpPort="+port+"&barrierPort="+y+"&director="+C+"&phone="+v+"&address="+w+"&remark="+t+"&ftp="+d;b="添加成功！";e="添加失败！";if(isNull(B)){layer.alert("用户中心名称不能为空！",{icon:0},function(D){layer.close(D);$("#name").select()});return}else{var r=true;$.ajax({type:"post",async:false,url:"../../manage/center/isExist.do",data:"centerName="+B,dataType:"json",success:function(D){if(D==true||D=="true"){r=false;layer.alert("用户中心名称已存在！",{icon:5},function(E){layer.close(E);$("#name").select()})}},error:function(E,G,F){r=false;if(E.readyState==4){var D=E.status;if(D==0||D>600){location.reload(true)}else{if(D==200){if(G=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+G)}}else{layer.alert("http connection error: status["+D+"], "+E.statusText)}}}}});if(!r){return}}}if(!isIP(u)){layer.alert("IP地址不正确！",{icon:2},function(D){layer.close(D);$("#ip").select()});return}if(!isPort(s)){layer.alert("Web端口不正确！",{icon:2},function(D){layer.close(D);$("#web").select()});return}if(!isPort(x)){layer.alert("监管端口不正确！",{icon:2},function(D){layer.close(D);$("#tcp").select()});return}if(!isPort(y)){layer.alert("道闸端口不正确！",{icon:2},function(D){layer.close(D);$("#barrier").select()});return}if(isNull(d)){layer.alert("ftp配置不能为空！",{icon:2},function(D){layer.close(D);$("#ftp").click()});return}if(isNull(C)){layer.alert("负责人不能为空！",{icon:0},function(D){layer.close(D);$("#director").select()});return}if(!isPhone(v)){layer.alert("电话号码不正确！",{icon:5},function(D){layer.close(D);$("#phone").select()});return}if(isNull(w)){layer.alert("地址不能为空！",{icon:0},function(D){layer.close(D);$("#address").select()});return}$.post(z,q,function(D){if("error"==D.msg){layer.msg(e,{icon:2,time:500})}else{layer.msg(b,{icon:1,time:500},function(){parent.layer.close(h)})}},"json").fail(function(E,G,F){if(E.readyState==4){var D=E.status;if(D==0||D>600){location.reload(true)}else{if(D==200){if(G=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+G)}}else{layer.alert("http connection error: status["+D+"], "+E.statusText)}}}})})});