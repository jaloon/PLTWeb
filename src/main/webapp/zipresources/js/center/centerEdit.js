$(function(){var y=parent.layer.getFrameIndex(window.name);var C;var E="修改成功！";var B="修改失败！";var z=$("#mode").val();var s="";var F="ftp",w="",q="",D="",t="",u="",r="";if("edit"==z){v();x()}function v(){F=$.trim($("#ftp_protocol").val());w=$.trim($("#ftp_host").val());q=$.trim($("#ftp_port").val())==""?"":parseInt($.trim($("#ftp_port").val()),10);D=$.trim($("#ftp_directory").val());t=$.trim($("#ftp_account").val());u=$.trim($("#ftp_password").val());r=$.trim($("#ftp_remark").val())}function x(){var a={protocol:F,host:w,port:q,directory:D,account:t,password:u,remark:r};s=encodeURIComponent(JSON.stringify(a));return a}$("#ftp").click(function(){var a="添加ftp配置";var b="361px";if("edit"==z){a="修改ftp配置"}else{if("view"==z){v();a="查看ftp配置";b="322px"}}C=layer.open({type:1,title:["用户中心管理（"+a+"）","font-size:14px;color:#ffffff;background:#478de4;"],area:["500px",b],content:$(".ftp"),end:A()})});function A(){$("#ftp_protocol").val(F);$("#ftp_host").val(w);$("#ftp_port").val(q);$("#ftp_directory").val(D);$("#ftp_account").val(t);$("#ftp_password").val(u);$("#ftp_remark").val(r)}$("#ftp_cancel").click(function(){A();layer.close(C)});$("#ftp_confirm").click(function(){var c=$.trim($("#ftp_protocol").val());var a=$.trim($("#ftp_host").val());var g=$.trim($("#ftp_port").val())==""?"":parseInt($.trim($("#ftp_port").val()),10);var b=$.trim($("#ftp_directory").val());var d=$.trim($("#ftp_account").val());var h=$.trim($("#ftp_password").val());var e=$.trim($("#ftp_remark").val());if(!isIP(a)){layer.alert("主机IP地址不正确！",{icon:2},function(i){layer.close(i);$("#ftp_host").select()});return}if(!isPort(g)){layer.alert("端口号不正确！",{icon:2},function(i){layer.close(i);$("#ftp_port").select()});return}if(!isFtpDir(b)){layer.alert("文件目录格式不正确！",{icon:2},function(i){layer.close(i);$("#ftp_directory").select()});return}if(isNull(d)){layer.alert("ftp账号不能为空！",{icon:2},function(i){layer.close(i);$("#ftp_account").select()});return}if(isNull(h)){layer.alert("ftp密码不能为空！",{icon:2},function(i){layer.close(i);$("#ftp_password").select()});return}v();var f=x();$("#ftp").html(ftpConfigConverter(f));layer.close(C)});$("#cancel").click(function(){parent.layer.close(y)});$("#confirm").click(function(){var m=$("#id").val();var a=$.trim($("#name").val());var g=$.trim($("#ip").val());var i=$.trim($("#web").val());var d=$.trim($("#tcp").val());var c=$.trim($("#barrier").val());var l=$.trim($("#director").val());var f=$.trim($("#phone").val());var e=$.trim($("#address").val());var h=$.trim($("#remark").val());var b="../../manage/center/update.do";var k="id="+m+"&name="+a+"&ip="+g+"&webPort="+i+"&tcpPort="+d+"&barrierPort="+c+"&director="+l+"&phone="+f+"&address="+e+"&remark="+h+"&ftp="+s;if("add"==z){b="../../manage/center/add.do";k="name="+a+"&ip="+g+"&webPort="+i+"&tcpPort="+port+"&barrierPort="+c+"&director="+l+"&phone="+f+"&address="+e+"&remark="+h+"&ftp="+s;E="添加成功！";B="添加失败！";if(isNull(a)){layer.alert("用户中心名称不能为空！",{icon:0},function(n){layer.close(n);$("#name").select()});return}else{var j=true;$.ajax({type:"post",async:false,url:"../../manage/center/isExist.do",data:"centerName="+a,dataType:"json",success:function(n){if(n==true||n=="true"){j=false;layer.alert("用户中心名称已存在！",{icon:5},function(o){layer.close(o);$("#name").select()})}},error:function(p,n,o){j=false;if(p.readyState==4){var H=p.status;if(H==0||H>600){location.reload(true)}else{if(H==200){if(n=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+n)}}else{layer.alert("http connection error: status["+H+"], "+p.statusText)}}}}});if(!j){return}}}if(!isIP(g)){layer.alert("IP地址不正确！",{icon:2},function(n){layer.close(n);$("#ip").select()});return}if(!isPort(i)){layer.alert("Web端口不正确！",{icon:2},function(n){layer.close(n);$("#web").select()});return}if(!isPort(d)){layer.alert("监管端口不正确！",{icon:2},function(n){layer.close(n);$("#tcp").select()});return}if(!isPort(c)){layer.alert("道闸端口不正确！",{icon:2},function(n){layer.close(n);$("#barrier").select()});return}if(isNull(s)){layer.alert("ftp配置不能为空！",{icon:2},function(n){layer.close(n);$("#ftp").click()});return}$.post(b,k,function(n){if("error"==n.msg){layer.msg(B,{icon:2,time:500})}else{layer.msg(E,{icon:1,time:500},function(){parent.layer.close(y)})}},"json").fail(function(p,n,o){if(p.readyState==4){var H=p.status;if(H==0||H>600){location.reload(true)}else{if(H==200){if(n=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+n)}}else{layer.alert("http connection error: status["+H+"], "+p.statusText)}}}})})});