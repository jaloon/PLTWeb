$(function(){var h=parent.layer.getFrameIndex(window.name);var p;var d="修改成功！";var e="修改失败！";var g=$("#mode").val();var b="";var c="ftp",j="",o="",n="",a="",l="",m="";if("edit"==g){k();i()}function k(){c=$.trim($("#ftp_protocol").val());j=$.trim($("#ftp_host").val());o=$.trim($("#ftp_port").val())==""?"":parseInt($.trim($("#ftp_port").val()),10);n=$.trim($("#ftp_directory").val());a=$.trim($("#ftp_account").val());l=$.trim($("#ftp_password").val());m=$.trim($("#ftp_remark").val())}function i(){var q={protocol:c,host:j,port:o,directory:n,account:a,password:l,remark:m};b=encodeURIComponent(JSON.stringify(q));return q}$("#ftp").click(function(){var r="添加ftp配置";var q="361px";if("edit"==g){r="修改ftp配置"}else{if("view"==g){k();r="查看ftp配置";q="322px"}}p=layer.open({type:1,title:["用户中心管理（"+r+"）","font-size:14px;color:#ffffff;background:#478de4;"],area:["500px",q],content:$(".ftp"),end:f()})});function f(){$("#ftp_protocol").val(c);$("#ftp_host").val(j);$("#ftp_port").val(o);$("#ftp_directory").val(n);$("#ftp_account").val(a);$("#ftp_password").val(l);$("#ftp_remark").val(m)}$("#ftp_cancel").click(function(){f();layer.close(p)});$("#ftp_confirm").click(function(){var v=$.trim($("#ftp_protocol").val());var x=$.trim($("#ftp_host").val());var r=$.trim($("#ftp_port").val())==""?"":parseInt($.trim($("#ftp_port").val()),10);var w=$.trim($("#ftp_directory").val());var u=$.trim($("#ftp_account").val());var q=$.trim($("#ftp_password").val());var t=$.trim($("#ftp_remark").val());if(!isIP(x)){layer.alert("主机IP地址不正确！",{icon:2},function(y){layer.close(y);$("#ftp_host").select()});return}if(!isPort(r)){layer.alert("端口号不正确！",{icon:2},function(y){layer.close(y);$("#ftp_port").select()});return}if(!isFtpDir(w)){layer.alert("文件目录格式不正确！",{icon:2},function(y){layer.close(y);$("#ftp_directory").select()});return}if(isNull(u)){layer.alert("ftp账号不能为空！",{icon:2},function(y){layer.close(y);$("#ftp_account").select()});return}if(isNull(q)){layer.alert("ftp密码不能为空！",{icon:2},function(y){layer.close(y);$("#ftp_password").select()});return}k();var s=i();$("#ftp").html(ftpConfigConverter(s));layer.close(p)});$("#cancel").click(function(){parent.layer.close(h)});$("#confirm").click(function(){var w=$("#id").val();var x=$.trim($("#name").val());var q=$.trim($("#ip").val());var A=$.trim($("#web").val());var t=$.trim($("#tcp").val());var u=$.trim($("#barrier").val());var y=$.trim($("#director").val());var r=$.trim($("#phone").val());var s=$.trim($("#address").val());var C=$.trim($("#remark").val());var v="../../manage/center/update.do";var z="id="+w+"&name="+x+"&ip="+q+"&webPort="+A+"&tcpPort="+t+"&barrierPort="+u+"&director="+y+"&phone="+r+"&address="+s+"&remark="+C+"&ftp="+b;if("add"==g){v="../../manage/center/add.do";z="name="+x+"&ip="+q+"&webPort="+A+"&tcpPort="+port+"&barrierPort="+u+"&director="+y+"&phone="+r+"&address="+s+"&remark="+C+"&ftp="+b;d="添加成功！";e="添加失败！";if(isNull(x)){layer.alert("用户中心名称不能为空！",{icon:0},function(D){layer.close(D);$("#name").select()});return}else{var B=true;$.ajax({type:"post",async:false,url:"../../manage/center/isExist.do",data:"centerName="+x,dataType:"json",success:function(D){if(D==true||D=="true"){B=false;layer.alert("用户中心名称已存在！",{icon:5},function(E){layer.close(E);$("#name").select()})}},error:function(E,G,F){B=false;if(E.readyState==4){var D=E.status;if(D==0||D>600){location.reload(true)}else{if(D==200){if(G=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+G)}}else{layer.alert("http connection error: status["+D+"], "+E.statusText)}}}}});if(!B){return}}}if(!isIP(q)){layer.alert("IP地址不正确！",{icon:2},function(D){layer.close(D);$("#ip").select()});return}if(!isPort(A)){layer.alert("Web端口不正确！",{icon:2},function(D){layer.close(D);$("#web").select()});return}if(!isPort(t)){layer.alert("监管端口不正确！",{icon:2},function(D){layer.close(D);$("#tcp").select()});return}if(!isPort(u)){layer.alert("道闸端口不正确！",{icon:2},function(D){layer.close(D);$("#barrier").select()});return}if(isNull(b)){layer.alert("ftp配置不能为空！",{icon:2},function(D){layer.close(D);$("#ftp").click()});return}$.post(v,z,function(D){if("error"==D.msg){layer.msg(e,{icon:2,time:500})}else{layer.msg(d,{icon:1,time:500},function(){parent.layer.close(h)})}},"json").fail(function(E,G,F){if(E.readyState==4){var D=E.status;if(D==0||D>600){location.reload(true)}else{if(D==200){if(G=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+G)}}else{layer.alert("http connection error: status["+D+"], "+E.statusText)}}}})})});