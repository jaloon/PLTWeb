var dispatch;var deleteDevice;var centerHtml="";$(function(){dispatch=function(b,a){var g="添加设备";var h="379px";if("edit"==b){var h="415px";g="修改设备信息"}if("view"==b){g="查看设备信息";h="358px"}layer.open({type:2,title:["设备管理（"+g+"）","font-size:14px;color:#ffffff;background:#478de4;"],shade:0.8,area:["540px",h],content:"../../manage/device/dispatch.do?mode="+b+"&id="+a,end:function(){if(b!="view"){c()}}})};deleteDevice=function(a){layer.confirm("删除后不可撤销，是否确认删除？",{icon:0,title:["删除","font-size:14px;color:#ffffff;background:#478de4;"]},function(){$.post("../../manage/device/delete.do","id="+a,function(b){if("success"==b.msg){layer.msg("删除成功！",{icon:1,time:500},function(){c()})}else{layer.msg("删除失败！",{icon:2,time:500})}},"json").fail(function(i,b,h){if(i.readyState==4){var j=i.status;if(j==0||j>600){location.reload(true)}else{if(j==200){if(b=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+b)}}else{layer.alert("http connection error: status["+j+"], "+i.statusText)}}}})})};function d(b,j,h){var a=$("#page_size").val();var i=(h-1)*a;$.post("../../manage/device/ajaxFindForPage.do","type="+b+"&centerId="+j+"&pageId="+h+"&startRow="+i+"&rows="+a,function(e){var f=$("#page_id option:last").index();var q=f+1-e.total;if(q>0){for(var g=e.total>0?e.total:1;g<f+1;g++){$("#page_id option:last").remove()}}else{if(q<0){for(var g=f+2;g<=e.total;g++){$("#page_id").append("<option value="+g+">"+g+"</option>")}}}$("#page_id").val(e.page);$("#page_info").html("页("+e.currentRows+"条数据)/共"+e.total+"页(共"+e.records+"条数据)");$("#dtype").val(e.t.type);$("#dcenter").val(e.t.centerId);$(".table-body").html("");var p=e.dataList;var r="<table width='100%'>";for(var g=0;g<e.currentRows;g++){var s=p[g];r+='<tr><td class="device-id">'+s.deviceId+'</td><td class="device-type">'+s.typeName+'</td><td class="device-ver">'+stringifyVer(s.ver)+'</td><td class="device-model">'+s.model+'</td><td class="device-center">'+s.centerName+'</td><td class="device-produce">'+s.produce+'</td><td class="device-delivery">'+s.delivery+'</td><td class="device-remark">'+s.remark+'</td><td class="device-action"><img src="../../resources/images/operate/view.png" alt="查看" title="查看" onclick="dispatch(\'view\','+s.id+')">&emsp;<img src="../../resources/images/operate/edit.png" alt="编辑" title="编辑" onclick="dispatch(\'edit\','+s.id+')">&emsp;<img src="../../resources/images/operate/delete.png" alt="删除" title="删除" onclick="deleteDevice('+s.id+')"></td></tr>'}r+="</table>";r=r.replace(/>null</g,"><");$(".table-body").html(r)},"json").fail(function(g,e,f){if(g.readyState==4){var l=g.status;if(l==0||l>600){location.reload(true)}else{if(l==200){if(e=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+e)}}else{layer.alert("http connection error: status["+l+"], "+g.statusText)}}}})}d("","",1);$("#search_type").change(function(){$("#search_text").empty();var a=$("#search_type").val();if(a==1){$("#search_text").append("<option value=1>车载终端</option><option value=2>锁</option><option value=3>出入库读卡器</option><option value=4>手持机</option>")}else{if(a==2){if(centerHtml.length==0){$.getJSON("../../manage/device/getCenterList.do",function(j){var k=j.length;if(k==0){layer.alert("无用户中心数据！");return}var b='<select id="search_text">';for(var i=0;i<k;i++){var l=j[i];b+="<option value="+l.id+">"+l.name+"</option>"}b+="</select>";centerHtml=b;$("#search_text").replaceWith(b)}).fail(function(i,b,h){if(i.readyState==4){var j=i.status;if(j==0||j>600){location.reload(true)}else{if(j==200){if(b=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+b)}}else{layer.alert("http connection error: status["+j+"], "+i.statusText)}}}})}else{$("#search_text").replaceWith(centerHtml)}}}});$("#search_btn").click(function(){var b=$("#search_type").val();if(b==0){layer.alert("请选择查询类型！",{icon:6})}else{var a=-2;var f=-2;if(b==1){a=$("#search_text").val()}else{f=$("#search_text").val()}d(a,f,1)}});function c(){var b=$("#page_id").val();if(isNull(b)){b=1}var a=$("#dtype").val();if(isNull(a)){a=-2}var f=$("#dcenter").val();if(isNull(f)){f=-2}d(a,f,b)}$("#page_id").change(function(){c()});$("#page_size").change(function(){var a=$("#dtype").val();if(isNull(a)){a=-2}var b=$("#dcenter").val();if(isNull(b)){b=-2}d(a,b,1)})});