$(function(){var f=parent.layer.getFrameIndex(window.name);var e="修改成功！";var h="修改失败！";var g=$("#mode").val();$("#cancel").click(function(){parent.layer.close(f)});$("#confirm").click(function(){var a=$("#id").val();var n=$("#assign").val();var o=$("#minver").val();var c="../../manage/appver/update.do";var b="id="+a+"&assignVer="+n+"&minVer="+o;if("add"==g){var p=$("#center").val();var d=$("#system").val();c="../../manage/appver/add.do";b="centerId="+p+"&system="+d+"&assignVer="+n+"&minVer="+o;e="添加成功！";h="添加失败！";var m=true;$.ajax({type:"post",async:false,url:"../../manage/appver/isExist.do",data:"centerId="+p+"&system="+d,dataType:"json",success:function(i){if(i==true||i=="true"){m=false;layer.alert("用户中心"+d+"APP版本配置信息已存在！",{icon:5},function(j){layer.close(j);$("#center").select()})}},error:function(l,j,k){if(l.readyState==4){var i=l.status;if(i==0||i>600){location.reload(true)}else{if(i==200){if(j=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+j)}}else{layer.alert("http connection error: status["+i+"], "+l.statusText)}}}}});if(!m){return}}if(!isVer(n)){layer.alert("指定版本不符合版本号格式！",{icon:2},function(i){layer.close(i);$("#assign").select()});return}if(!isVer(o)){layer.alert("最低版本不符合版本号格式！",{icon:2},function(i){layer.close(i);$("#minver").select()});return}$.post(c,b,function(i){if("error"==i.msg){layer.msg(h,{icon:2,time:500})}else{layer.msg(e,{icon:1,time:500},function(){parent.layer.close(f)})}},"json").fail(function(l,j,k){if(l.readyState==4){var i=l.status;if(i==0||i>600){location.reload(true)}else{if(i==200){if(j=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+j)}}else{layer.alert("http connection error: status["+i+"], "+l.statusText)}}}})})});