var dispatch;var deleteAppver;function getDefaultVer(){var a=true;$.ajax({type:"get",async:false,url:"../../manage/appver/getDefaultVer.do",dataType:"text",success:function(b){$(".default-ver").remove();if(b==null||b==undefined||b.length==0||b=="[]"){$("#add_default_ver").before("")}else{var c=JSON.parse(b);var d="";c.forEach(function(e){d+="<tr class='default-ver'><td>"+e.appid+"</td><td>"+e.system+"</td><td>"+e.assignVer+"</td><td>"+e.minVer+"</td><td><img src='../../resources/images/operate/edit.png' alt=编辑 title='编辑' onclick=\"dispatch(false,'edit',"+e.id+")\">&emsp;<img src='../../resources/images/operate/delete.png' alt='删除' title='删除' onclick='deleteAppver(false,"+e.id+")'></td></tr>"});$("#add_default_ver").before(d)}},error:function(c,e,d){a=false;if(c.readyState==4){var b=c.status;if(b==0||b>600){location.reload(true)}else{if(b==200){if(e=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+e)}}else{layer.alert("http connection error: status["+b+"], "+c.statusText)}}}}});return a}function showDefaultVer(){if(getDefaultVer()){layer.open({type:1,title:["APP缺省版本管理（针对所有中心）","font-size:14px;color:#ffffff;background:#478de4;"],shade:0.8,area:"540px",content:$("#default_ver_box")})}}$(function(){$("#add_default_ver td span").click(function(){dispatch(false,"defaut",0)});dispatch=function(d,f,g){var e="添加APP版本信息";var c="307px";if("defaut"==f){c="271px"}if("edit"==f){e="修改APP版本信息"}if("view"==f){e="查看APP版本信息";c="250px"}layer.open({type:2,title:["APP版本信息管理（"+e+"）","font-size:14px;color:#ffffff;background:#478de4;"],shade:0.8,area:["540px",c],content:"../../manage/appver/dispatch.do?mode="+f+"&id="+g,end:function(){if(d){b()}else{getDefaultVer()}}})};deleteAppver=function(c,d){layer.confirm("删除后不可撤销，是否确认删除？",{icon:0,title:["删除","font-size:14px;color:#ffffff;background:#478de4;"]},function(){$.post("../../manage/appver/delete.do","id="+d,function(e){if("success"==e.msg){layer.msg("删除成功！",{icon:1,time:500},function(){if(c){b()}else{getDefaultVer()}})}else{layer.msg("删除失败！",{icon:2,time:500})}},"json").fail(function(f,h,g){if(f.readyState==4){var e=f.status;if(e==0||e>600){location.reload(true)}else{if(e==200){if(h=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+h)}}else{layer.alert("http connection error: status["+e+"], "+f.statusText)}}}})})};function a(c,e){var f=$("#page_size").val();var d=(e-1)*f;$.post("../../manage/appver/ajaxFindForPage.do","centerName="+c+"&pageId="+e+"&startRow="+d+"&rows="+f,function(l){var k=$("#page_id option:last").index();var g=k+1-l.total;if(g>0){for(var j=l.total>0?l.total:1;j<k+1;j++){$("#page_id option:last").remove()}}else{if(g<0){for(var j=k+2;j<=l.total;j++){$("#page_id").append("<option value="+j+">"+j+"</option>")}}}$("#page_id").val(l.page);$("#page_info").html("页("+l.currentRows+"条数据)/共"+l.total+"页(共"+l.records+"条数据)");$("#avcenter").val(l.t.centerName);$(".table-body").html("");var h=l.dataList;var m="<table width='100%'>";for(var j=0;j<l.currentRows;j++){var n=h[j];m+='<tr><td class="appver-center">'+n.centerName+'</td><td class="appver-appid">'+n.appid+'</td><td class="appver-system">'+n.system+'</td><td class="appver-assign">'+n.assignVer+'</td><td class="appver-min">'+n.minVer+'</td><td class="appver-action"><img src="../../resources/images/operate/view.png" alt="查看" title="查看" onclick="dispatch(false,\'view\','+n.id+')">&emsp;<img src="../../resources/images/operate/edit.png" alt="编辑" title="编辑" onclick="dispatch(true,\'edit\','+n.id+')">&emsp;<img src="../../resources/images/operate/delete.png" alt="删除" title="删除" onclick="deleteAppver(true,'+n.id+')"></td></tr>'}m+="</table>";m=m.replace(/>null</g,"><");$(".table-body").html(m)},"json").fail(function(h,j,i){if(h.readyState==4){var g=h.status;if(g==0||g>600){location.reload(true)}else{if(g==200){if(j=="parsererror"){layer.alert("应答数据格式解析错误！")}else{layer.alert("http response error: "+j)}}else{layer.alert("http connection error: status["+g+"], "+h.statusText)}}}})}a("",1);$("#search_btn").click(function(){var c=$("#search_text").val();a(c,1)});function b(){var d=$("#page_id").val();if(isNull(d)){d=1}var c=$("#avcenter").val();if(isNull(c)){c=""}a(c,d)}$("#page_id").change(function(){b()});$("#page_size").change(function(){var c=$("#avcenter").val();if(isNull(c)){c=""}a(c,1)})});